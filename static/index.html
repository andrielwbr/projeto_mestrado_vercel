<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>RunAI - Performance & Sa√∫de</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; padding-bottom: 40px; }
        .app-container { max-width: 480px; margin: 20px auto; background: #fff; border-radius: 24px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .app-header { background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; padding: 30px 20px; text-align: center; }
        .app-body { padding: 25px; }
        .btn-submit { background-color: #111827; color: white; width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 600; margin-top: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="app-header">
        <h1>RunAI Pro</h1>
        <p>Preven√ß√£o de Les√µes</p>
    </div>

    <div class="app-body">
        <form onsubmit="event.preventDefault(); enviarTreino();">
            
            <div class="mb-4 p-3 bg-light rounded border">
                <label class="form-label small text-muted fw-bold">QUEM √â VOC√ä?</label>
                <input type="text" class="form-control form-control-sm" id="user_id" placeholder="Ex: andriel, bernardo..." required>
            </div>

            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="km" placeholder="0" step="0.01" required>
                        <label>Dist√¢ncia (KM)</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="tempo" placeholder="0" step="1" required>
                        <label>Tempo (min)</label>
                    </div>
                </div>
            </div>

            <div class="form-floating mb-3">
                <input type="number" class="form-control" id="calorias" placeholder="0" required>
                <label>Calorias (kcal)</label>
            </div>

            <div class="form-floating mb-3">
                <select class="form-select" id="clima" required>
                    <option value="Sol">Ensolarado ‚òÄÔ∏è</option>
                    <option value="Nublado">Nublado ‚òÅÔ∏è</option>
                    <option value="Chuva">Chuvoso üåßÔ∏è</option>
                </select>
                <label>Condi√ß√£o Clim√°tica</label>
            </div>

            <div class="mb-3">
                <label class="form-label d-flex justify-content-between fw-bold text-secondary">
                    <span>Esfor√ßo (0-10)</span>
                    <span id="valorIntensidade" class="text-primary">5</span>
                </label>
                <input type="range" class="form-range" min="0" max="10" step="1" id="esforco" value="5" oninput="document.getElementById('valorIntensidade').innerText = this.value">
            </div>

            <button type="submit" class="btn-submit" id="btnEnviar">Analisar Risco</button>
        </form>

        <div id="resultadoContainer" style="display:none; margin-top:30px;">
            </div>
    </div>
</div>

<script>
    // Ao carregar a p√°gina, tenta recuperar o nome salvo
    window.onload = function() {
        const salvo = localStorage.getItem("runai_user");
        if (salvo) document.getElementById("user_id").value = salvo;
    }

    async function enviarTreino() {
        const btn = document.getElementById('btnEnviar');
        const originalText = btn.innerText;
        btn.innerText = "Processando...";
        btn.disabled = true;

        // Salva o usu√°rio no navegador para a pr√≥xima vez
        const usuario = document.getElementById("user_id").value.trim().toLowerCase();
        localStorage.setItem("runai_user", usuario);

        try {
            const dados = {
                user_id: usuario, // Envia quem √© o dono
                km: parseFloat(document.getElementById('km').value),
                tempo: parseFloat(document.getElementById('tempo').value),
                calorias: parseFloat(document.getElementById('calorias').value),
                esforco: parseInt(document.getElementById('esforco').value),
                clima: document.getElementById('clima').value
            };

            const response = await fetch('/registrar_treino', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            if (!response.ok) throw new Error(await response.text());
            const json = await response.json();
            mostrarAnalise(json.analise);

            btn.innerText = "Salvo!";
            setTimeout(() => { btn.innerText = originalText; btn.disabled = false; }, 2000);

        } catch (error) {
            alert("Erro: " + error.message);
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }

    function mostrarAnalise(analise) {
        const container = document.getElementById('resultadoContainer');
        container.style.display = 'block';
        
        let cor = "#16a34a"; // Verde
        if (analise.status.includes("ALTO")) cor = "#dc2626"; // Vermelho
        if (analise.status.includes("MODERADO")) cor = "#f59e0b"; // Amarelo

        container.innerHTML = `
            <div class="text-center mb-4 p-3 rounded" style="background-color: ${cor}15; border: 1px solid ${cor}">
                <h2 class="fw-bold" style="color: ${cor}">${analise.status}</h2>
                <p class="mb-0 text-muted">${analise.mensagem}</p>
            </div>
            <div class="alert alert-secondary">
                <strong>üìà Pr√≥ximo Passo:</strong><br> ${analise.sugerido_proximo}
            </div>
        `;
        container.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
