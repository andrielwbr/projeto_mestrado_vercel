<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>RunAI Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #334155; }
        .main-card { max-width: 500px; margin: 20px auto; background: white; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); overflow: hidden; }
        .header { background: #0f172a; color: white; padding: 25px; text-align: center; }
        .section-title { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: #94a3b8; font-weight: 700; margin-bottom: 15px; margin-top: 10px; }
        .form-control, .form-select { border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; }
        .btn-run { background: #2563eb; color: white; width: 100%; padding: 15px; border-radius: 12px; font-weight: 600; border: none; margin-top: 20px; }
        .btn-run:hover { background: #1d4ed8; }
        
        /* Card de Resultado */
        .prescription-card { background: #fff; border-radius: 15px; border: 1px solid #e2e8f0; padding: 20px; margin-top: 20px; display: none; animation: slideUp 0.5s; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; display: inline-block; margin-bottom: 10px; }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="main-card">
    <div class="header">
        <h2 class="m-0 fw-bold">RunAI Coach</h2>
        <small style="opacity: 0.8">Intelig√™ncia Artificial Esportiva</small>
    </div>

    <div class="p-4">
        <form onsubmit="event.preventDefault(); enviarTreino();">
            
            <div class="section-title">üë§ Perfil do Atleta</div>
            <div class="row g-2 mb-3">
                <div class="col-12">
                    <input type="text" class="form-control" id="user_id" placeholder="Seu Nome / Apelido" required>
                </div>
                <div class="col-6">
                    <input type="number" class="form-control" id="idade" placeholder="Idade" required>
                </div>
                <div class="col-6">
                    <select class="form-select" id="nivel">
                        <option value="iniciante">Iniciante</option>
                        <option value="avancado">J√° corro</option>
                    </select>
                </div>
            </div>

            <div class="section-title">üèÉ Treino de Hoje</div>
            <div class="row g-2 mb-3">
                <div class="col-6">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="km" placeholder="KM" step="0.1" required>
                        <label>Dist√¢ncia (km)</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <input type="number" class="form-control" id="tempo" placeholder="Min" required>
                        <label>Tempo (min)</label>
                    </div>
                </div>
            </div>

            <label class="form-label d-flex justify-content-between small text-muted fw-bold">
                <span>INTENSIDADE (PERCEP√á√ÉO)</span>
                <span id="valorEsforco" class="text-primary">5</span>
            </label>
            <input type="range" class="form-range" min="1" max="10" id="esforco" value="5" oninput="document.getElementById('valorEsforco').innerText = this.value">

            <input type="hidden" id="calorias" value="0">
            <input type="hidden" id="clima" value="Nublado">

            <button type="submit" class="btn-run" id="btnEnviar">ANALISAR PERFORMANCE</button>
        </form>

        <div id="resultado" class="prescription-card">
            <div id="statusBadge" class="status-badge" style="background: #dcfce7; color: #166534">üü¢ ZONA IDEAL</div>
            
            <h5 class="fw-bold mb-2">An√°lise T√©cnica</h5>
            <p id="msgAnalise" class="text-muted small">Sua carga est√° dentro do planejado.</p>
            
            <hr>
            
            <div class="row text-center mt-3">
                <div class="col-6 border-end">
                    <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem">Recomenda√ß√£o</small>
                    <div id="acaoRecomendada" class="fw-bold text-dark mt-1">Descanso 24h</div>
                </div>
                <div class="col-6">
                    <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem">Pr√≥ximo Treino</small>
                    <div id="proximoTreino" class="fw-bold text-primary mt-1">5km Leve</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Carrega dados salvos
    window.onload = () => {
        if(localStorage.getItem('runai_user')) document.getElementById('user_id').value = localStorage.getItem('runai_user');
        if(localStorage.getItem('runai_age')) document.getElementById('idade').value = localStorage.getItem('runai_age');
        if(localStorage.getItem('runai_level')) document.getElementById('nivel').value = localStorage.getItem('runai_level');
    };

    async function enviarTreino() {
        const btn = document.getElementById('btnEnviar');
        const resultadoDiv = document.getElementById('resultado');
        
        btn.innerText = "Calculando Prescri√ß√£o...";
        btn.disabled = true;
        resultadoDiv.style.display = 'none';

        // Salva perfil
        const user = document.getElementById('user_id').value;
        const idade = document.getElementById('idade').value;
        const nivel = document.getElementById('nivel').value;
        
        localStorage.setItem('runai_user', user);
        localStorage.setItem('runai_age', idade);
        localStorage.setItem('runai_level', nivel);

        const dados = {
            user_id: user,
            idade: parseInt(idade),
            nivel: nivel,
            km: parseFloat(document.getElementById('km').value),
            tempo: parseFloat(document.getElementById('tempo').value),
            calorias: 0, // Estimativa futura
            esforco: parseInt(document.getElementById('esforco').value),
            clima: "Nublado"
        };

        try {
            const req = await fetch('/registrar_treino', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(dados)
            });
            
            const res = await req.json();
            mostrarPrescricao(res.analise);

        } catch (e) {
            alert("Erro de conex√£o: " + e);
        } finally {
            btn.innerText = "ANALISAR PERFORMANCE";
            btn.disabled = false;
        }
    }

    function mostrarPrescricao(data) {
        const div = document.getElementById('resultado');
        const badge = document.getElementById('statusBadge');
        
        // Cores Din√¢micas
        if(data.status.includes("RISCO")) {
            badge.style.background = "#fee2e2"; badge.style.color = "#991b1b";
        } else if(data.status.includes("BAIXA")) {
            badge.style.background = "#fef3c7"; badge.style.color = "#92400e";
        } else {
            badge.style.background = "#dcfce7"; badge.style.color = "#166534";
        }

        badge.innerText = data.status;
        document.getElementById('msgAnalise').innerText = data.mensagem;
        document.getElementById('acaoRecomendada').innerText = data.acao;
        document.getElementById('proximoTreino').innerText = data.proximo_treino;

        div.style.display = 'block';
        div.scrollIntoView({behavior: 'smooth'});
    }
</script>

</body>
</html>
